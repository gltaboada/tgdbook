<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4.2 Manipulación de datos con dplyr y tidyr | Prácticas de Tecnologías de Gestión y Manipulación de Datos</title>
  <meta name="description" content="Prácticas de la asignatura de Tecnologías de Gestión de Datos del Máster en Técnicas Estadísticas." />
  <meta name="generator" content="bookdown 0.45 and GitBook 2.6.7" />

  <meta property="og:title" content="4.2 Manipulación de datos con dplyr y tidyr | Prácticas de Tecnologías de Gestión y Manipulación de Datos" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Prácticas de la asignatura de Tecnologías de Gestión de Datos del Máster en Técnicas Estadísticas." />
  <meta name="github-repo" content="gltaboada/tgdbook" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4.2 Manipulación de datos con dplyr y tidyr | Prácticas de Tecnologías de Gestión y Manipulación de Datos" />
  
  <meta name="twitter:description" content="Prácticas de la asignatura de Tecnologías de Gestión de Datos del Máster en Técnicas Estadísticas." />
  

<meta name="author" content="Guillermo López Taboada (guillermo.lopez.taboada@udc.es), Diego Darriba (diego.darriba@udc.es) y Rubén F. Casal (ruben.fcasal@udc.es)" />


<meta name="date" content="2025-10-24" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="introTidyverse.html"/>
<link rel="next" href="tidyr-pkg.html"/>
<script src="libs/jquery-3.6.1/jquery-3.6.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.33/datatables.js"></script>
<link href="libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>


<style type="text/css">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Prácticas de TGD</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Prólogo</a></li>
<li class="chapter" data-level="1" data-path="introducción.html"><a href="introducción.html"><i class="fa fa-check"></i><b>1</b> Introducción</a>
<ul>
<li class="chapter" data-level="1.1" data-path="contenidos.html"><a href="contenidos.html"><i class="fa fa-check"></i><b>1.1</b> Contenidos</a></li>
<li class="chapter" data-level="1.2" data-path="planificación-tentativa.html"><a href="planificación-tentativa.html"><i class="fa fa-check"></i><b>1.2</b> Planificación (tentativa)</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="planificación-tentativa.html"><a href="planificación-tentativa.html#evaluaci%C3%B3n"><i class="fa fa-check"></i><b>1.2.1</b> Evaluación</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="fuentes-de-información.html"><a href="fuentes-de-información.html"><i class="fa fa-check"></i><b>1.3</b> Fuentes de información:</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="fuentes-de-información.html"><a href="fuentes-de-información.html#b%C3%A1sica"><i class="fa fa-check"></i><b>1.3.1</b> Básica</a></li>
<li class="chapter" data-level="1.3.2" data-path="fuentes-de-información.html"><a href="fuentes-de-información.html#complementaria"><i class="fa fa-check"></i><b>1.3.2</b> Complementaria:</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="manipR.html"><a href="manipR.html"><i class="fa fa-check"></i><b>2</b> Manipulación de datos con R</a>
<ul>
<li class="chapter" data-level="2.1" data-path="read.html"><a href="read.html"><i class="fa fa-check"></i><b>2.1</b> Lectura, importación y exportación de datos</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="read.html"><a href="read.html#formato-de-datos-de-r"><i class="fa fa-check"></i><b>2.1.1</b> Formato de datos de R</a></li>
<li class="chapter" data-level="2.1.2" data-path="read.html"><a href="read.html#acceso-a-datos-en-paquetes"><i class="fa fa-check"></i><b>2.1.2</b> Acceso a datos en paquetes</a></li>
<li class="chapter" data-level="2.1.3" data-path="read.html"><a href="read.html#cap2-texto"><i class="fa fa-check"></i><b>2.1.3</b> Lectura de archivos de texto</a></li>
<li class="chapter" data-level="2.1.4" data-path="read.html"><a href="read.html#importaci%C3%B3n-desde-spss"><i class="fa fa-check"></i><b>2.1.4</b> Importación desde SPSS</a></li>
<li class="chapter" data-level="2.1.5" data-path="read.html"><a href="read.html#importaci%C3%B3n-desde-excel"><i class="fa fa-check"></i><b>2.1.5</b> Importación desde Excel</a></li>
<li class="chapter" data-level="2.1.6" data-path="read.html"><a href="read.html#cap2-exporta"><i class="fa fa-check"></i><b>2.1.6</b> Exportación de datos</a></li>
<li class="chapter" data-level="2.1.7" data-path="read.html"><a href="read.html#python-julia-y-otros-lenguajes-de-programaci%C3%B3n"><i class="fa fa-check"></i><b>2.1.7</b> Python, Julia y otros lenguajes de programación</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="manipulación-de-datos.html"><a href="manipulación-de-datos.html"><i class="fa fa-check"></i><b>2.2</b> Manipulación de datos</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="manipulación-de-datos.html"><a href="manipulación-de-datos.html#operaciones-con-variables"><i class="fa fa-check"></i><b>2.2.1</b> Operaciones con variables</a></li>
<li class="chapter" data-level="2.2.2" data-path="manipulación-de-datos.html"><a href="manipulación-de-datos.html#operaciones-con-casos"><i class="fa fa-check"></i><b>2.2.2</b> Operaciones con casos</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="missing.html"><a href="missing.html"><i class="fa fa-check"></i><b>2.3</b> Datos faltantes</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="missing.html"><a href="missing.html#funciones-apply"><i class="fa fa-check"></i><b>2.3.1</b> Funciones <code>apply</code></a></li>
<li class="chapter" data-level="2.3.2" data-path="missing.html"><a href="missing.html#tablas-para-informes"><i class="fa fa-check"></i><b>2.3.2</b> Tablas (para informes)</a></li>
<li class="chapter" data-level="2.3.3" data-path="missing.html"><a href="missing.html#operaciones-con-tablas-de-datos"><i class="fa fa-check"></i><b>2.3.3</b> Operaciones con tablas de datos</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="ejemplo-wos-data.html"><a href="ejemplo-wos-data.html"><i class="fa fa-check"></i><b>2.4</b> Ejemplo WoS data</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="introSQL.html"><a href="introSQL.html"><i class="fa fa-check"></i><b>3</b> Introducción al lenguaje SQL</a>
<ul>
<li class="chapter" data-level="3.1" data-path="bases-de-datos-relacionales.html"><a href="bases-de-datos-relacionales.html"><i class="fa fa-check"></i><b>3.1</b> Bases de Datos Relacionales</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="bases-de-datos-relacionales.html"><a href="bases-de-datos-relacionales.html#definiciones"><i class="fa fa-check"></i><b>3.1.1</b> Definiciones</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="restricciones.html"><a href="restricciones.html"><i class="fa fa-check"></i><b>3.2</b> Restricciones</a></li>
<li class="chapter" data-level="3.3" data-path="sistemas-gestores-de-bases-de-datos-sgdb.html"><a href="sistemas-gestores-de-bases-de-datos-sgdb.html"><i class="fa fa-check"></i><b>3.3</b> Sistemas Gestores de Bases de Datos (SGDB)</a></li>
<li class="chapter" data-level="3.4" data-path="sintaxis-sql.html"><a href="sintaxis-sql.html"><i class="fa fa-check"></i><b>3.4</b> Sintaxis SQL</a></li>
<li class="chapter" data-level="3.5" data-path="cláusulas-básicas-de-sql.html"><a href="cláusulas-básicas-de-sql.html"><i class="fa fa-check"></i><b>3.5</b> Cláusulas básicas de SQL</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="cláusulas-básicas-de-sql.html"><a href="cláusulas-básicas-de-sql.html#lectura"><i class="fa fa-check"></i><b>3.5.1</b> Lectura</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="gestión-de-tablas.html"><a href="gestión-de-tablas.html"><i class="fa fa-check"></i><b>3.6</b> Gestión de tablas</a></li>
<li class="chapter" data-level="3.7" data-path="gestión-de-datos.html"><a href="gestión-de-datos.html"><i class="fa fa-check"></i><b>3.7</b> Gestión de datos</a></li>
<li class="chapter" data-level="3.8" data-path="gestión-de-bases-de-datos.html"><a href="gestión-de-bases-de-datos.html"><i class="fa fa-check"></i><b>3.8</b> Gestión de Bases de Datos</a></li>
<li class="chapter" data-level="3.9" data-path="ejemplos-de-consultas-sql.html"><a href="ejemplos-de-consultas-sql.html"><i class="fa fa-check"></i><b>3.9</b> Ejemplos de consultas SQL</a></li>
<li class="chapter" data-level="3.10" data-path="conexión-con-bases-de-datos-desde-r.html"><a href="conexión-con-bases-de-datos-desde-r.html"><i class="fa fa-check"></i><b>3.10</b> Conexión con bases de datos desde R</a>
<ul>
<li class="chapter" data-level="3.10.1" data-path="conexión-con-bases-de-datos-desde-r.html"><a href="conexión-con-bases-de-datos-desde-r.html#introducci%C3%B3n-a-sql-en-r"><i class="fa fa-check"></i><b>3.10.1</b> Introducción a SQL en R</a></li>
<li class="chapter" data-level="3.10.2" data-path="conexión-con-bases-de-datos-desde-r.html"><a href="conexión-con-bases-de-datos-desde-r.html#el-paquete-sqldf"><i class="fa fa-check"></i><b>3.10.2</b> El paquete sqldf</a></li>
<li class="chapter" data-level="3.10.3" data-path="conexión-con-bases-de-datos-desde-r.html"><a href="conexión-con-bases-de-datos-desde-r.html#sql-queries"><i class="fa fa-check"></i><b>3.10.3</b> SQL Queries</a></li>
</ul></li>
<li class="chapter" data-level="3.11" data-path="ejemplo-scopus-data.html"><a href="ejemplo-scopus-data.html"><i class="fa fa-check"></i><b>3.11</b> Ejemplo Scopus data</a></li>
<li class="chapter" data-level="3.12" data-path="ejercicios-sql-con-rsqlite.html"><a href="ejercicios-sql-con-rsqlite.html"><i class="fa fa-check"></i><b>3.12</b> Ejercicios SQL con RSQLite</a>
<ul>
<li class="chapter" data-level="3.12.1" data-path="ejercicios-sql-con-rsqlite.html"><a href="ejercicios-sql-con-rsqlite.html#setup-de-rsqlite"><i class="fa fa-check"></i><b>3.12.1</b> Setup de RSQLite</a></li>
</ul></li>
<li class="chapter" data-level="3.13" data-path="práctica-1-sql.html"><a href="práctica-1-sql.html"><i class="fa fa-check"></i><b>3.13</b> Práctica 1: SQL</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="tidyverse.html"><a href="tidyverse.html"><i class="fa fa-check"></i><b>4</b> Manipulación de datos con tidyverse</a>
<ul>
<li class="chapter" data-level="4.1" data-path="introTidyverse.html"><a href="introTidyverse.html"><i class="fa fa-check"></i><b>4.1</b> Introducción al ecosistema tidyverse</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="introTidyverse.html"><a href="introTidyverse.html#pipe"><i class="fa fa-check"></i><b>4.1.1</b> Operador <em>pipe</em> (redirección)</a></li>
<li class="chapter" data-level="4.1.2" data-path="introTidyverse.html"><a href="introTidyverse.html#readr"><i class="fa fa-check"></i><b>4.1.2</b> Lectura y escritura de archivos de texto</a></li>
<li class="chapter" data-level="4.1.3" data-path="introTidyverse.html"><a href="introTidyverse.html#writer"><i class="fa fa-check"></i><b>4.1.3</b> Escritura</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="dplyr.html"><a href="dplyr.html"><i class="fa fa-check"></i><b>4.2</b> Manipulación de datos con dplyr y tidyr</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="dplyr.html"><a href="dplyr.html#dplyr-pkg"><i class="fa fa-check"></i><b>4.2.1</b> El paquete dplyr</a></li>
<li class="chapter" data-level="4.2.2" data-path="dplyr.html"><a href="dplyr.html#dplyr-variables"><i class="fa fa-check"></i><b>4.2.2</b> Operaciones con variables (columnas)</a></li>
<li class="chapter" data-level="4.2.3" data-path="dplyr.html"><a href="dplyr.html#dplyr-casos"><i class="fa fa-check"></i><b>4.2.3</b> Operaciones con casos (filas)</a></li>
<li class="chapter" data-level="4.2.4" data-path="dplyr.html"><a href="dplyr.html#tidyr-missing"><i class="fa fa-check"></i><b>4.2.4</b> Datos faltantes</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="tidyr-pkg.html"><a href="tidyr-pkg.html"><i class="fa fa-check"></i><b>4.3</b> Herramientas tidyr</a></li>
<li class="chapter" data-level="4.4" data-path="dplyr-join.html"><a href="dplyr-join.html"><i class="fa fa-check"></i><b>4.4</b> Operaciones con tablas de datos</a></li>
<li class="chapter" data-level="4.5" data-path="dbplyr.html"><a href="dbplyr.html"><i class="fa fa-check"></i><b>4.5</b> Bases de datos con dplyr</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="dbplyr.html"><a href="dbplyr.html#ejemplos"><i class="fa fa-check"></i><b>4.5.1</b> Ejemplos</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="introducción-a-tecnologías-nosql.html"><a href="introducción-a-tecnologías-nosql.html"><i class="fa fa-check"></i><b>5</b> Introducción a Tecnologías NoSQL</a>
<ul>
<li class="chapter" data-level="5.1" data-path="conceptos-y-tipos-de-bases-de-datos-nosql-documental-columnar-clavevalor-y-de-grafos.html"><a href="conceptos-y-tipos-de-bases-de-datos-nosql-documental-columnar-clavevalor-y-de-grafos.html"><i class="fa fa-check"></i><b>5.1</b> Conceptos y tipos de bases de datos NoSQL (documental, columnar, clave/valor y de grafos)</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="conceptos-y-tipos-de-bases-de-datos-nosql-documental-columnar-clavevalor-y-de-grafos.html"><a href="conceptos-y-tipos-de-bases-de-datos-nosql-documental-columnar-clavevalor-y-de-grafos.html#caracter%C3%ADsticas-de-las-bases-de-datos-nosql"><i class="fa fa-check"></i><b>5.1.1</b> Características de las bases de datos NoSQL</a></li>
<li class="chapter" data-level="5.1.2" data-path="conceptos-y-tipos-de-bases-de-datos-nosql-documental-columnar-clavevalor-y-de-grafos.html"><a href="conceptos-y-tipos-de-bases-de-datos-nosql-documental-columnar-clavevalor-y-de-grafos.html#tipos-de-bases-de-datos-nosql"><i class="fa fa-check"></i><b>5.1.2</b> Tipos de Bases de Datos NoSQL</a></li>
<li class="chapter" data-level="5.1.3" data-path="conceptos-y-tipos-de-bases-de-datos-nosql-documental-columnar-clavevalor-y-de-grafos.html"><a href="conceptos-y-tipos-de-bases-de-datos-nosql-documental-columnar-clavevalor-y-de-grafos.html#mongodb-nosql-documental"><i class="fa fa-check"></i><b>5.1.3</b> MongoDB: NoSQL documental</a></li>
<li class="chapter" data-level="5.1.4" data-path="conceptos-y-tipos-de-bases-de-datos-nosql-documental-columnar-clavevalor-y-de-grafos.html"><a href="conceptos-y-tipos-de-bases-de-datos-nosql-documental-columnar-clavevalor-y-de-grafos.html#redis-nosql-key-value"><i class="fa fa-check"></i><b>5.1.4</b> Redis: NoSQL key-value</a></li>
<li class="chapter" data-level="5.1.5" data-path="conceptos-y-tipos-de-bases-de-datos-nosql-documental-columnar-clavevalor-y-de-grafos.html"><a href="conceptos-y-tipos-de-bases-de-datos-nosql-documental-columnar-clavevalor-y-de-grafos.html#cassandra-nosql-columnar"><i class="fa fa-check"></i><b>5.1.5</b> Cassandra: NoSQL columnar</a></li>
<li class="chapter" data-level="5.1.6" data-path="conceptos-y-tipos-de-bases-de-datos-nosql-documental-columnar-clavevalor-y-de-grafos.html"><a href="conceptos-y-tipos-de-bases-de-datos-nosql-documental-columnar-clavevalor-y-de-grafos.html#neo4j-nosql-grafos"><i class="fa fa-check"></i><b>5.1.6</b> Neo4j: NoSQL grafos</a></li>
<li class="chapter" data-level="5.1.7" data-path="conceptos-y-tipos-de-bases-de-datos-nosql-documental-columnar-clavevalor-y-de-grafos.html"><a href="conceptos-y-tipos-de-bases-de-datos-nosql-documental-columnar-clavevalor-y-de-grafos.html#otros-search-engines"><i class="fa fa-check"></i><b>5.1.7</b> Otros: search engines</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="conexión-de-r-a-mongodb.html"><a href="conexión-de-r-a-mongodb.html"><i class="fa fa-check"></i><b>5.2</b> Conexión de R a MongoDB</a></li>
<li class="chapter" data-level="5.3" data-path="ejercicios-prácticos-con-mongodb.html"><a href="ejercicios-prácticos-con-mongodb.html"><i class="fa fa-check"></i><b>5.3</b> Ejercicios prácticos con MongoDB</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="tecnologías-para-el-tratamiendo-de-datos-masivos.html"><a href="tecnologías-para-el-tratamiendo-de-datos-masivos.html"><i class="fa fa-check"></i><b>6</b> Tecnologías para el Tratamiendo de Datos Masivos</a>
<ul>
<li class="chapter" data-level="6.1" data-path="introducción-al-aprendizaje-estadístico.html"><a href="introducción-al-aprendizaje-estadístico.html"><i class="fa fa-check"></i><b>6.1</b> Introducción al Aprendizaje Estadístico</a></li>
<li class="chapter" data-level="6.2" data-path="tecnologías-big-data-hadoopspark-y-visualización.html"><a href="tecnologías-big-data-hadoopspark-y-visualización.html"><i class="fa fa-check"></i><b>6.2</b> Tecnologías Big Data (Hadoop/Spark y Visualización)</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="tecnologías-big-data-hadoopspark-y-visualización.html"><a href="tecnologías-big-data-hadoopspark-y-visualización.html#tecnolog%C3%ADas-hadoop-spark-y-sparklyr"><i class="fa fa-check"></i><b>6.2.1</b> Tecnologías Hadoop, Spark, y Sparklyr</a></li>
<li class="chapter" data-level="6.2.2" data-path="tecnologías-big-data-hadoopspark-y-visualización.html"><a href="tecnologías-big-data-hadoopspark-y-visualización.html#big-data-y-machine-learning"><i class="fa fa-check"></i><b>6.2.2</b> Big Data y Machine Learning</a></li>
<li class="chapter" data-level="6.2.3" data-path="tecnologías-big-data-hadoopspark-y-visualización.html"><a href="tecnologías-big-data-hadoopspark-y-visualización.html#rattle-como-alternativa-a-rapidminer-en-r"><i class="fa fa-check"></i><b>6.2.3</b> Rattle como alternativa a RapidMiner en R</a></li>
<li class="chapter" data-level="6.2.4" data-path="tecnologías-big-data-hadoopspark-y-visualización.html"><a href="tecnologías-big-data-hadoopspark-y-visualización.html#visualizaci%C3%B3n-y-generaci%C3%B3n-de-cuadros-de-mando"><i class="fa fa-check"></i><b>6.2.4</b> Visualización y Generación de Cuadros de Mando</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="introducción-al-análisis-de-datos-masivos.html"><a href="introducción-al-análisis-de-datos-masivos.html"><i class="fa fa-check"></i><b>6.3</b> Introducción al Análisis de Datos Masivos</a></li>
</ul></li>
<li class="appendix"><span><b>Apendices</b></span></li>
<li class="chapter" data-level="A" data-path="links.html"><a href="links.html"><i class="fa fa-check"></i><b>A</b> Enlaces</a>
<ul>
<li class="chapter" data-level="A.1" data-path="rstudio-links.html"><a href="rstudio-links.html"><i class="fa fa-check"></i><b>A.1</b> RStudio</a></li>
<li class="chapter" data-level="A.2" data-path="bibliom-links.html"><a href="bibliom-links.html"><i class="fa fa-check"></i><b>A.2</b> Bibliometría</a></li>
</ul></li>
<li class="chapter" data-level="B" data-path="instalación-de-r.html"><a href="instalación-de-r.html"><i class="fa fa-check"></i><b>B</b> Instalación de R</a>
<ul>
<li class="chapter" data-level="B.1" data-path="instalación-de-r-en-windows.html"><a href="instalación-de-r-en-windows.html"><i class="fa fa-check"></i><b>B.1</b> Instalación de R en Windows</a>
<ul>
<li class="chapter" data-level="B.1.1" data-path="instalación-de-r-en-windows.html"><a href="instalación-de-r-en-windows.html#asistente-de-instalaci%C3%B3n"><i class="fa fa-check"></i><b>B.1.1</b> Asistente de instalación</a></li>
<li class="chapter" data-level="B.1.2" data-path="instalación-de-r-en-windows.html"><a href="instalación-de-r-en-windows.html#instalaci%C3%B3n-de-paquetes"><i class="fa fa-check"></i><b>B.1.2</b> Instalación de paquetes</a></li>
</ul></li>
<li class="chapter" data-level="B.2" data-path="instalación-en-mac-os-x.html"><a href="instalación-en-mac-os-x.html"><i class="fa fa-check"></i><b>B.2</b> Instalación en Mac OS X</a></li>
<li class="chapter" data-level="B.3" data-path="instalación-opcional-de-un-entorno-o-editor-de-comandos.html"><a href="instalación-opcional-de-un-entorno-o-editor-de-comandos.html"><i class="fa fa-check"></i><b>B.3</b> Instalación (opcional) de un entorno o editor de comandos</a>
<ul>
<li class="chapter" data-level="B.3.1" data-path="instalación-opcional-de-un-entorno-o-editor-de-comandos.html"><a href="instalación-opcional-de-un-entorno-o-editor-de-comandos.html#opciones-adicionales"><i class="fa fa-check"></i><b>B.3.1</b> Opciones adicionales</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Publicado con bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Prácticas de Tecnologías de Gestión y Manipulación de Datos</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="dplyr" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Manipulación de datos con dplyr y tidyr<a href="dplyr.html#dplyr" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<!--
# Introducción  {#dplyr}
-->
<p>En esta sección se realiza una breve introducción al paquete <a href="https://dplyr.tidyverse.org"><code>dplyr</code></a> y se comentan algunas de las utilidades del paquete <a href="https://tidyr.tidyverse.org"><code>tidyr</code></a> que pueden resultar de interés<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a>.</p>
<p>La referencia recomendada para iniciarse en esta herramienta es el Capítulo <a href="http://r4ds.had.co.nz/transform.html">5 Data transformation</a> de
<a href="http://r4ds.had.co.nz">R for Data Science</a>.
También puede resultar de utilidad la viñeta del paquete <a href="https://dplyr.tidyverse.org/articles/dplyr.html">Introduction to dplyr</a> o la <a href="https://posit.co/wp-content/uploads/2022/10/data-transformation-1.pdf">chuleta</a> (menú de RStudio <em>Help &gt; Cheat Sheets &gt; Data Transformation with dplyr</em>).</p>
<div id="dplyr-pkg" class="section level3 hasAnchor" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> El paquete dplyr<a href="dplyr.html#dplyr-pkg" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="dplyr.html#cb253-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code></pre></div>
<p>La principal ventaja de <a href="https://dplyr.tidyverse.org/index.html"><code>dplyr</code></a> es que permite trabajar (de la misma forma) con datos en distintos formatos:</p>
<ul>
<li><p><code>data.frame</code>, <a href="https://tibble.tidyverse.org/"><code>tibble</code></a>.</p></li>
<li><p><a href="https://rdatatable.gitlab.io/data.table"><code>data.table</code></a>: extensión (paquete <em>backend</em>) <a href="https://dtplyr.tidyverse.org"><code>dtplyr</code></a>.</p></li>
<li><p>conjuntos de datos más grandes que la memoria disponible: extensiones <a href="https://duckdb.org/docs/api/r"><code>duckdb</code></a> y <a href="https://arrow.apache.org/docs/r/"><code>arrow</code></a> (incluyendo almacenamiento en la nube, e.g. <a href="https://aws.amazon.com/es/s3">AWS</a>).</p></li>
<li><p>bases de datos relacionales (lenguaje SQL, locales o remotas); extensión <a href="https://dbplyr.tidyverse.org"><code>dbplyr</code></a>.</p></li>
<li><p>grandes volúmenes de datos (incluso almacenados en múltiples servidores; ecosistema <a href="http://hadoop.apache.org/">Hadoop</a>/<a href="https://spark.apache.org/">Spark</a>): extensión <a href="https://spark.rstudio.com"><code>sparklyr</code></a> (ver menú de RStudio <em>Help &gt; Cheat Sheets &gt; Interfacing Spark with sparklyr</em>).</p></li>
</ul>
<p>El paquete dplyr permite sustituir operaciones con funciones base de R (como <a href="NA"><code>subset</code></a>, <a href="NA"><code>split</code></a>, <a href="NA"><code>apply</code></a>, <a href="NA"><code>sapply</code></a>, <a href="NA"><code>lapply</code></a>, <a href="NA"><code>tapply</code></a>, <a href="NA"><code>aggregate</code></a>…) por una “gramática” más sencilla para la manipulación de datos.
En lugar de operar sobre vectores como la mayoría de las funciones base,
opera sobre conjuntos de datos (de forma que es compatible con el operador <code>%&gt;%</code>).
Los principales “verbos” (funciones) son:</p>
<ul>
<li><p><a href="https://dplyr.tidyverse.org/reference/select.html"><code>select()</code></a>: seleccionar variables (ver también <a href="https://dplyr.tidyverse.org/reference/rename.html"><code>rename</code></a>, <a href="https://dplyr.tidyverse.org/reference/rename.html"><code>relocate</code></a>, <a href="https://dplyr.tidyverse.org/reference/rename.html"><code>pull</code></a>).</p></li>
<li><p><a href="https://dplyr.tidyverse.org/reference/mutate.html"><code>mutate()</code></a>: crear variables (ver también <code>transmute()</code>).</p></li>
<li><p><a href="https://dplyr.tidyverse.org/reference/filter.html"><code>filter()</code></a>: seleccionar casos/filas (ver también <code>slice()</code>).</p></li>
<li><p><a href="https://dplyr.tidyverse.org/reference/arrange.html"><code>arrange()</code></a>: ordenar casos/filas.</p></li>
<li><p><a href="https://dplyr.tidyverse.org/reference/summarise.html"><code>summarise()</code></a>: resumir valores.</p></li>
<li><p><a href="https://dplyr.tidyverse.org/reference/group_by.html"><code>group_by()</code></a>: permite operaciones por grupo empleando el concepto “dividir-aplicar-combinar” (<code>ungroup()</code> elimina el agrupamiento).</p></li>
</ul>
<p>NOTA: Para entender el funcionamiento de ciertas funciones (como <a href="https://dplyr.tidyverse.org/reference/rowwise.html"><code>rowwise()</code></a>) y las posibilidades en el manejo de datos, hay que tener en cuenta que un <code>data.frame</code> no es más que una lista cuyas componentes (variables) tienen la misma longitud.
Realmente las componentes también pueden ser listas de la misma longitud y, por tanto, podemos almacenar casi cualquier estructura de datos en un <code>data.frame</code>.</p>
<p>En la primera parte de este capítulo consideraremos solo <code>data.frame</code> por comodidad.
Emplearemos como ejemplo los datos de empleados de banca almacenados en el fichero <em>empleados.RData</em> (y supondremos que estamos interesados en estudiar si hay discriminación por cuestión de sexo o raza).</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="dplyr.html#cb254-1" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;data/empleados.RData&quot;</span>)</span>
<span id="cb254-2"><a href="dplyr.html#cb254-2" tabindex="-1"></a><span class="fu">attr</span>(empleados, <span class="st">&quot;variable.labels&quot;</span>) <span class="ot">&lt;-</span> <span class="cn">NULL</span>                  </span></code></pre></div>
<p>En la Sección <a href="dbplyr.html#dbplyr">4.5</a> final emplearemos una base de datos relacional como ejemplo.</p>
</div>
<div id="dplyr-variables" class="section level3 hasAnchor" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> Operaciones con variables (columnas)<a href="dplyr.html#dplyr-variables" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Podemos <strong>seleccionar variables con <a href="https://dplyr.tidyverse.org/reference/select.html"><code>select()</code></a></strong>:</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="dplyr.html#cb255-1" tabindex="-1"></a>emplea2 <span class="ot">&lt;-</span> empleados <span class="sc">%&gt;%</span> <span class="fu">select</span>(id, sexo, minoria, tiempemp, </span>
<span id="cb255-2"><a href="dplyr.html#cb255-2" tabindex="-1"></a>                                salini, salario)</span>
<span id="cb255-3"><a href="dplyr.html#cb255-3" tabindex="-1"></a><span class="fu">head</span>(emplea2)</span></code></pre></div>
<pre><code>##   id   sexo minoria tiempemp salini salario
## 1  1 Hombre      No       98  27000   57000
## 2  2 Hombre      No       98  18750   40200
## 3  3  Mujer      No       98  12000   21450
## 4  4  Mujer      No       98  13200   21900
## 5  5 Hombre      No       98  21000   45000
## 6  6 Hombre      No       98  13500   32100</code></pre>
<p>Se puede cambiar el nombre (ver también <a href="https://dplyr.tidyverse.org/reference/rename.html"><code>rename()</code></a>):</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="dplyr.html#cb257-1" tabindex="-1"></a>empleados <span class="sc">%&gt;%</span> <span class="fu">select</span>(sexo, <span class="at">noblanca =</span> minoria, salario) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>##     sexo noblanca salario
## 1 Hombre       No   57000
## 2 Hombre       No   40200
## 3  Mujer       No   21450
## 4  Mujer       No   21900
## 5 Hombre       No   45000
## 6 Hombre       No   32100</code></pre>
<p>Se pueden emplear los nombres de variables como índices:</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="dplyr.html#cb259-1" tabindex="-1"></a>empleados <span class="sc">%&gt;%</span> <span class="fu">select</span>(sexo<span class="sc">:</span>salario) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>##     sexo    fechnac educ         catlab salario
## 1 Hombre 1952-02-03   15      Directivo   57000
## 2 Hombre 1958-05-23   16 Administrativo   40200
## 3  Mujer 1929-07-26   12 Administrativo   21450
## 4  Mujer 1947-04-15    8 Administrativo   21900
## 5 Hombre 1955-02-09   15 Administrativo   45000
## 6 Hombre 1958-08-22   15 Administrativo   32100</code></pre>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="dplyr.html#cb261-1" tabindex="-1"></a><span class="co"># empleados %&gt;% select(-(sexo:salario)) %&gt;% head()</span></span>
<span id="cb261-2"><a href="dplyr.html#cb261-2" tabindex="-1"></a>empleados <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">!</span>(sexo<span class="sc">:</span>salario)) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>##   id salini tiempemp expprev minoria     sexoraza
## 1  1  27000       98     144      No Blanca varón
## 2  2  18750       98      36      No Blanca varón
## 3  3  12000       98     381      No Blanca mujer
## 4  4  13200       98     190      No Blanca mujer
## 5  5  21000       98     138      No Blanca varón
## 6  6  13500       98      67      No Blanca varón</code></pre>
<p>Se pueden emplear distintas herramientas (<em><a href="https://tidyselect.r-lib.org/reference/language.html">selection helpers</a></em>) para seleccionar variables (ver paquete <a href="https://tidyselect.r-lib.org"><code>tidyselect</code></a>):</p>
<ul>
<li><p><a href="https://tidyselect.r-lib.org/reference/starts_with.html"><code>starts_with</code></a>, <a href="https://tidyselect.r-lib.org/reference/starts_with.html"><code>ends_with</code></a>, <a href="https://tidyselect.r-lib.org/reference/starts_with.html"><code>contains</code></a>, <a href="https://tidyselect.r-lib.org/reference/starts_with.html"><code>matches</code></a>, <a href="https://tidyselect.r-lib.org/reference/starts_with.html"><code>num_range</code></a>: variables que coincidan con un patrón.</p></li>
<li><p><a href="https://tidyselect.r-lib.org/reference/all_of.html"><code>all_of</code></a>, <a href="https://tidyselect.r-lib.org/reference/all_of.html"><code>any_of</code></a>: variables de un vectores de caracteres.</p></li>
<li><p><a href="https://tidyselect.r-lib.org/reference/everything.html"><code>everything</code></a>, <a href="https://tidyselect.r-lib.org/reference/everything.html"><code>last_col</code></a>: todas las variables o la última variable.</p></li>
<li><p><a href="https://tidyselect.r-lib.org/reference/where.html"><code>where()</code></a>: a partir de una función (e.g. <code>where(is.numeric)</code>)</p></li>
</ul>
<p>Por ejemplo:</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="dplyr.html#cb263-1" tabindex="-1"></a>empleados <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;s&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>##     sexo salario salini     sexoraza
## 1 Hombre   57000  27000 Blanca varón
## 2 Hombre   40200  18750 Blanca varón
## 3  Mujer   21450  12000 Blanca mujer
## 4  Mujer   21900  13200 Blanca mujer
## 5 Hombre   45000  21000 Blanca varón
## 6 Hombre   32100  13500 Blanca varón</code></pre>
<p>Podemos <strong>crear variables con <a href="https://dplyr.tidyverse.org/reference/mutate.html"><code>mutate()</code></a></strong>:</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="dplyr.html#cb265-1" tabindex="-1"></a>emplea2 <span class="sc">%&gt;%</span> </span>
<span id="cb265-2"><a href="dplyr.html#cb265-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">incsal =</span> salario <span class="sc">-</span> salini, <span class="at">tsal =</span> incsal<span class="sc">/</span>tiempemp) <span class="sc">%&gt;%</span> </span>
<span id="cb265-3"><a href="dplyr.html#cb265-3" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>##   id   sexo minoria tiempemp salini salario incsal      tsal
## 1  1 Hombre      No       98  27000   57000  30000 306.12245
## 2  2 Hombre      No       98  18750   40200  21450 218.87755
## 3  3  Mujer      No       98  12000   21450   9450  96.42857
## 4  4  Mujer      No       98  13200   21900   8700  88.77551
## 5  5 Hombre      No       98  21000   45000  24000 244.89796
## 6  6 Hombre      No       98  13500   32100  18600 189.79592</code></pre>
</div>
<div id="dplyr-casos" class="section level3 hasAnchor" number="4.2.3">
<h3><span class="header-section-number">4.2.3</span> Operaciones con casos (filas)<a href="dplyr.html#dplyr-casos" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Podemos <strong>seleccionar casos con <a href="https://dplyr.tidyverse.org/reference/filter.html"><code>filter()</code></a></strong>:</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="dplyr.html#cb267-1" tabindex="-1"></a>emplea2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sexo <span class="sc">==</span> <span class="st">&quot;Mujer&quot;</span>, minoria <span class="sc">==</span> <span class="st">&quot;Sí&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## [1] id       sexo     minoria  tiempemp salini   salario 
## &lt;0 rows&gt; (or 0-length row.names)</code></pre>
<p>Podemos <strong>reordenar casos con <a href="https://dplyr.tidyverse.org/reference/arrange.html"><code>arrange()</code></a></strong>:</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="dplyr.html#cb269-1" tabindex="-1"></a>emplea2 <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(salario) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>##    id  sexo minoria tiempemp salini salario
## 1 378 Mujer      No       70  10200   15750
## 2 338 Mujer      No       74  10200   15900
## 3  90 Mujer      No       92   9750   16200
## 4 224 Mujer      No       82  10200   16200
## 5 411 Mujer      No       68  10200   16200
## 6 448 Mujer   S\xed       66  10200   16350</code></pre>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="dplyr.html#cb271-1" tabindex="-1"></a>emplea2 <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(salini), salario) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>##    id   sexo minoria tiempemp salini salario
## 1  29 Hombre      No       96  79980  135000
## 2 343 Hombre      No       73  60000  103500
## 3 205 Hombre      No       83  52500   66750
## 4 160 Hombre      No       86  47490   66000
## 5 431 Hombre      No       66  45000   86250
## 6  32 Hombre      No       96  45000  110625</code></pre>
<p>Podemos <strong>resumir valores con <a href="https://dplyr.tidyverse.org/reference/summarise.html"><code>summarise()</code></a></strong>:</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="dplyr.html#cb273-1" tabindex="-1"></a>empleados <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">sal.med =</span> <span class="fu">mean</span>(salario), <span class="at">n =</span> <span class="fu">n</span>())</span></code></pre></div>
<pre><code>##    sal.med   n
## 1 34419.57 474</code></pre>
<p>Para realizar <strong>operaciones con múltiples variables podemos emplear <a href="https://dplyr.tidyverse.org/reference/across.html"><code>across()</code></a></strong> (admite selección de variables <a href="https://tidyselect.r-lib.org"><code>tidyselect</code></a>):</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="dplyr.html#cb275-1" tabindex="-1"></a>empleados <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), mean), <span class="at">n =</span> <span class="fu">n</span>())</span></code></pre></div>
<pre><code>##      id     educ  salario   salini tiempemp  expprev   n
## 1 237.5 13.49156 34419.57 17016.09  81.1097 95.86076 474</code></pre>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="dplyr.html#cb277-1" tabindex="-1"></a><span class="co"># empleados %&gt;% summarise(across(where(is.numeric) &amp; !id, mean), n = n())</span></span></code></pre></div>
<p>NOTA: Esta función sustituye a las “variantes de ámbito” <code>_at()</code>, <code>_if()</code> y <code>_all()</code> de versiones anteriores de dplyr (como <code>summarise_at()</code>, <code>summarise_if()</code>, <code>summarise_all()</code>, <code>mutate_at()</code>, <code>mutate_if()</code>…) y también el uso de <code>vars()</code>.
En el caso de <code>filter()</code> se puede emplear <a href="https://dplyr.tidyverse.org/reference/across.html"><code>if_any()</code></a> e <a href="https://dplyr.tidyverse.org/reference/across.html"><code>if_all()</code></a>.</p>
<p>Podemos <strong>agrupar casos con <a href="https://dplyr.tidyverse.org/reference/group_by.html"><code>group_by()</code></a></strong>:</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="dplyr.html#cb278-1" tabindex="-1"></a>empleados <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(sexo, minoria) <span class="sc">%&gt;%</span> </span>
<span id="cb278-2"><a href="dplyr.html#cb278-2" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">sal.med =</span> <span class="fu">mean</span>(salario), <span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb278-3"><a href="dplyr.html#cb278-3" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span></code></pre></div>
<pre><code>## # A tibble: 4 × 4
##   sexo   minoria sal.med     n
##   &lt;fct&gt;  &lt;fct&gt;     &lt;dbl&gt; &lt;int&gt;
## 1 Hombre &quot;No&quot;     44475.   194
## 2 Hombre &quot;S\xed&quot;  32246.    64
## 3 Mujer  &quot;No&quot;     26707.   176
## 4 Mujer  &quot;S\xed&quot;  23062.    40</code></pre>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="dplyr.html#cb280-1" tabindex="-1"></a>empleados <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(sexo, minoria) <span class="sc">%&gt;%</span> </span>
<span id="cb280-2"><a href="dplyr.html#cb280-2" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">sal.med =</span> <span class="fu">mean</span>(salario), <span class="at">n =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 4 × 4
##   sexo   minoria sal.med     n
##   &lt;fct&gt;  &lt;fct&gt;     &lt;dbl&gt; &lt;int&gt;
## 1 Hombre &quot;No&quot;     44475.   194
## 2 Hombre &quot;S\xed&quot;  32246.    64
## 3 Mujer  &quot;No&quot;     26707.   176
## 4 Mujer  &quot;S\xed&quot;  23062.    40</code></pre>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="dplyr.html#cb282-1" tabindex="-1"></a><span class="co"># dplyr &gt;= 1.1.0 # packageVersion(&quot;dplyr&quot;)</span></span>
<span id="cb282-2"><a href="dplyr.html#cb282-2" tabindex="-1"></a><span class="co"># empleados %&gt;% summarise(sal.med = mean(salario), n = n(), </span></span>
<span id="cb282-3"><a href="dplyr.html#cb282-3" tabindex="-1"></a><span class="co">#                         .by = c(sexo, minoria))</span></span></code></pre></div>
<p>Por defecto la agrupación se mantiene para el resto de operaciones, habría que emplear <code>ungroup()</code> (o el argumento <code>.groups = "drop"</code>) para eliminarla (se puede emplear <code>group_vars()</code> o <code>str()</code> para ver la agrupación).
Desde dplyr 1.1.0 (2023-01-29) está disponible un parámetro <code>.by/by</code> en <code>mutate()</code>, <code>summarise()</code>, <code>filter()</code> y <code>slice()</code> como alternativa a agrupar y desagrupar posteriormente.
Para más detalles ver <a href="https://dplyr.tidyverse.org/reference/dplyr_by.html">Per-operation grouping with .by/by</a>.</p>
</div>
<div id="tidyr-missing" class="section level3 hasAnchor" number="4.2.4">
<h3><span class="header-section-number">4.2.4</span> Datos faltantes<a href="dplyr.html#tidyr-missing" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Continuamos con el ejemplo de la Sección @ref{missing}.
<em>tidyverse</em> dispone de muchas herramientas para el tratamiento de los datos faltantes.</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="dplyr.html#cb283-1" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;airquality&quot;</span>)</span>
<span id="cb283-2"><a href="dplyr.html#cb283-2" tabindex="-1"></a>datos <span class="ot">&lt;-</span> airquality</span>
<span id="cb283-3"><a href="dplyr.html#cb283-3" tabindex="-1"></a><span class="fu">library</span>(visdat)</span>
<span id="cb283-4"><a href="dplyr.html#cb283-4" tabindex="-1"></a><span class="fu">vis_dat</span>(airquality)</span>
<span id="cb283-5"><a href="dplyr.html#cb283-5" tabindex="-1"></a><span class="co"># vis_miss(airquality)</span></span></code></pre></div>
<p>Visualización (amigable) de la estrutura de datos:</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="dplyr.html#cb284-1" tabindex="-1"></a><span class="fu">library</span>(naniar)</span>
<span id="cb284-2"><a href="dplyr.html#cb284-2" tabindex="-1"></a><span class="fu">bind_shadow</span>(airquality)</span></code></pre></div>
<pre><code>## # A tibble: 153 × 12
##    Ozone Solar.R  Wind  Temp Month   Day Ozone_NA Solar.R_NA Wind_NA Temp_NA
##    &lt;int&gt;   &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;fct&gt;    &lt;fct&gt;      &lt;fct&gt;   &lt;fct&gt;  
##  1    41     190   7.4    67     5     1 !NA      !NA        !NA     !NA    
##  2    36     118   8      72     5     2 !NA      !NA        !NA     !NA    
##  3    12     149  12.6    74     5     3 !NA      !NA        !NA     !NA    
##  4    18     313  11.5    62     5     4 !NA      !NA        !NA     !NA    
##  5    NA      NA  14.3    56     5     5 NA       NA         !NA     !NA    
##  6    28      NA  14.9    66     5     6 !NA      NA         !NA     !NA    
##  7    23     299   8.6    65     5     7 !NA      !NA        !NA     !NA    
##  8    19      99  13.8    59     5     8 !NA      !NA        !NA     !NA    
##  9     8      19  20.1    61     5     9 !NA      !NA        !NA     !NA    
## 10    NA     194   8.6    69     5    10 NA       !NA        !NA     !NA    
## # ℹ 143 more rows
## # ℹ 2 more variables: Month_NA &lt;fct&gt;, Day_NA &lt;fct&gt;</code></pre>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="dplyr.html#cb286-1" tabindex="-1"></a><span class="co"># nabular(airquality)</span></span></code></pre></div>
<p>Distribución por variables de los datos faltantes:</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="dplyr.html#cb287-1" tabindex="-1"></a><span class="fu">miss_var_table</span>(airquality) </span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##   n_miss_in_var n_vars pct_vars
##           &lt;int&gt;  &lt;int&gt;    &lt;dbl&gt;
## 1             0      4     66.7
## 2             7      1     16.7
## 3            37      1     16.7</code></pre>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="dplyr.html#cb289-1" tabindex="-1"></a><span class="fu">prop_miss_case</span>(airquality)</span></code></pre></div>
<pre><code>## [1] 0.2745098</code></pre>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="dplyr.html#cb291-1" tabindex="-1"></a><span class="fu">gg_miss_upset</span>(airquality) </span></code></pre></div>
<p><img src="04-dplyr_files/figure-html/unnamed-chunk-23-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>Distribución conjunta de los valores faltantes para la radiación solar y ozono:</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="dplyr.html#cb292-1" tabindex="-1"></a><span class="fu">library</span>(naniar)</span>
<span id="cb292-2"><a href="dplyr.html#cb292-2" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb292-3"><a href="dplyr.html#cb292-3" tabindex="-1"></a><span class="fu">ggplot</span>(airquality, </span>
<span id="cb292-4"><a href="dplyr.html#cb292-4" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> Solar.R, </span>
<span id="cb292-5"><a href="dplyr.html#cb292-5" tabindex="-1"></a>           <span class="at">y =</span> Ozone)) <span class="sc">+</span> </span>
<span id="cb292-6"><a href="dplyr.html#cb292-6" tabindex="-1"></a>  <span class="fu">geom_miss_point</span>()</span></code></pre></div>
<p><img src="04-dplyr_files/figure-html/unnamed-chunk-24-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>Distribución mensual de los valores faltantes:</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="dplyr.html#cb293-1" tabindex="-1"></a><span class="co"># gg_miss_var(airquality)</span></span>
<span id="cb293-2"><a href="dplyr.html#cb293-2" tabindex="-1"></a><span class="fu">gg_miss_var</span>(airquality, <span class="at">facet =</span> Month)</span></code></pre></div>
<p><img src="04-dplyr_files/figure-html/unnamed-chunk-25-1.png" width="80%" style="display: block; margin: auto;" /></p>
<!--
library(dplyr)
gg_miss_upset(pen) # Relacioese entre las variables en los datos ausentes
n_miss(penguins)
tidyr::replace_na: Missing values turns into a value (NA –> -99)
naniar::replace_with_na: Value becomes a missing value (-99 –> NA)
as_shadow(airquality)
aq_shadow <- bind_shadow(airquality)
aq_nab <- nabular(airquality)

glimpse(aq_shadow)
glimpse(aq_nab)
# Numerical summaries of missing values
dplyr::n_distinct(airquality)
## [1] 153
dplyr::n_distinct(airquality$Ozone)
prop_miss_case(airquality)
miss_case_summary(airquality)
Future development
Make naniar work with big data tools like sparklyr, and sparklingwater.
Provide tools for assessing goodness of fit for classical approaches of MCAR, MAR, and MNAR (graphical inference from nullabor package)
-->
</div>
</div>
<div class="footnotes">
<hr />
<ol start="5">
<li id="fn5"><p>Otra alternativa (más rápida) es <a href="https://rdatatable.gitlab.io/data.table"><code>data.table</code></a> pero en versiones recientes ya se puede emplear desde <code>dplyr</code>, como se comenta más adelante.<a href="dplyr.html#fnref5" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="introTidyverse.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="tidyr-pkg.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": true,
    "facebook": false,
    "twitter": false,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/gltaboada/tgdbook/edit/master/04-dplyr.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["Practicas_de_TGD.pdf"],
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
